version: 2

sources:
  - name: northstar
    database: '{{ env_var("NORTHSTAR_TARGET_DB") }}'
    schema: 'northstar'
    tables:
      - name: users

models:

  - name: users_fnmt
    description: A table containing aggregated user data.

    columns:
        - name: northstar_id
          description: '{{ doc("northstar_id") }}'

        - name: created_at
          description: '{{ doc("created_at") }}'

        - name: last_logged_in
          description: '{{ doc("last_logged_in") }}'

        - name: last_accessed
          description: '{{ doc("last_accessed") }}'

        - name: last_messaged_at
          description: '{{ doc("last_messaged_at") }}'

        - name: source
          description: '{{ doc("source") }}'

        - name: email
          description: '{{ doc("email") }}'

        - name: facebook_id
          description: '{{ doc("facebook_id") }}'

        - name: mobile
          description: '{{ doc("mobile") }}'

        - name: birthdate
          description: '{{ doc("birthdate") }}'

        - name: first_name
          description: '{{ doc("first_name") }}'

        - name: last_name
          description: '{{ doc("last_name") }}'

        - name: voter_registration_status
          description: '{{ doc("voter_registration_status") }}'

        - name: address_street_1
          description: '{{ doc("address_street_1") }}'

        - name: address_street_2
          description: '{{ doc("address_street_2") }}'

        - name: city
          description: '{{ doc("city") }}'

        - name: state
          description: '{{ doc("state") }}'

        - name: zipcode
          description: '{{ doc("postal_code") }}'

        - name: country
          description: '{{ doc("country") }}'

        - name: language
          description: '{{ doc("language") }}'

        - name: cio_status
          description: '{{ doc("cio_status") }}'

        - name: cio_status_timestamp
          description: '{{ doc("cio_status_timestamp") }}'

        - name: sms_status
          description: '{{ doc("sms_status") }}'

        - name: source_detail
          description: '{{ doc("source_detail") }}'

        - name: utm_medium
          description: '{{ doc("utm_medium") }}'

        - name: utm_source
          description: '{{ doc("utm_source") }}'

        - name: utm_campaign
          description: '{{ doc("utm_campaign") }}'

        - name: badges
          description: '{{ doc("badges") }}'

        - name: refer_friends
          description: '{{ doc("refer_friends") }}'

        - name: subscribed_member
          description: '{{ doc("subscribed_member") }}'

        - name: last_updated_at
          description: '{{ doc("last_updated_at") }}'

        - name: school_id
          description: '{{ doc("school_id") }}'
  - name: northstar_users_raw_fnmt
    description: A table containing aggregated user data.

    columns: &northstar_users_raw_fnmt_columns
        - name: northstar_id
          description: '{{ doc("northstar_id") }}'

        - name: country
          description: '{{ doc("country") }}'

        - name: birthdate
          description: '{{ doc("birthdate") }}'

        - name: drupal_id
          description: '{{ doc("drupal_id") }}'

        - name: email_subscription_status
          description: '{{ doc("email_subscription_status") }}'

        - name: created_at
          description: '{{ doc("created_at") }}'

        - name: addr_zip
          description: '{{ doc("postal_code") }}'

        - name: language
          description: '{{ doc("language") }}'

        - name: source
          description: '{{ doc("source") }}'

        - name: updated_at
          description: '{{ doc("updated_at") }}'

        - name: campaigns
          description: '{{ doc("campaigns") }}'

        - name: audit
          description: '{{ doc("audit") }}'

        - name: first_name
          description: '{{ doc("first_name") }}'

        - name: email
          description: '{{ doc("email") }}'

        - name: last_name
          description: '{{ doc("last_name") }}'

        - name: addr_state
          description: '{{ doc("state") }}'

        - name: addr_street_2
          description: '{{ doc("address_street_2") }}'

        - name: addr_street_1
          description: '{{ doc("address_street_1") }}'

        - name: addr_city
          description: '{{ doc("city") }}'

        - name: role
          description: '{{ doc("role") }}'

        - name: sms_status
          description: '{{ doc("sms_status") }}'

        - name: last_authenticated_at
          description: '{{ doc("last_logged_in") }}'

        - name: last_accessed
          description: '{{ doc("last_accessed") }}'

        - name: mobile
          description: '{{ doc("mobile") }}'

        - name: cio_backfilled
          description: '{{ doc("cio_backfilled") }}'

        - name: addr_source
          description: '{{ doc("addr_source") }}'

        - name: source_detail
          description: '{{ doc("source_detail") }}'

        - name: last_messaged_at
          description: '{{ doc("last_messaged_at") }}'

        - name: email_subscription_topics
          description: '{{ doc("email_subscription_topics") }}'

        - name: sms_paused
          description: '{{ doc("sms_paused") }}'

        - name: voting_plan_status
          description: '{{ doc("voting_plan_status") }}'

        - name: voting_plan_time_of_day
          description: '{{ doc("voting_plan_time_of_day") }}'

        - name: voting_plan_method_of_transport
          description: '{{ doc("voting_plan_method_of_transport") }}'

        - name: voting_plan_attending_with
          description: '{{ doc("voting_plan_attending_with") }}'

        - name: voter_registration_status
          description: '{{ doc("voter_registration_status") }}'

        - name: facebook_id
          description: '{{ doc("facebook_id") }}'

        - name: deleted_at
          description: '{{ doc("deleted_at") }}'

        - name: feature_flags
          description: '{{ doc("feature_flags") }}'

        - name: dbt_scd_id
          description: '{{ doc("dbt_scd_id") }}'

        - name: dbt_updated_at
          description: '{{ doc("dbt_updated_at") }}'

        - name: dbt_valid_from
          description: '{{ doc("dbt_valid_from") }}'

        - name: dbt_valid_to
          description: '{{ doc("dbt_valid_to") }}'

        - name: google_id
          description: '{{ doc("google_id") }}'

        - name: causes
          description: '{{ doc("causes") }}'

        - name: school_id
          description: '{{ doc("school_id") }}'
  - name: northstar_users_deduped_fnmt
    description: A table containing deduped aggregated user data.

    columns: *northstar_users_raw_fnmt_columns
  - name: user_activity_fnmt
    description: Table containing aggregated user activity data.

    columns:
      - name: northstar_id
        description: '{{ doc("northstar_id") }}'

      - name: created_at
        description: '{{ doc("created_at") }}'

      - name: sms_status
        description: '{{ doc("sms_status") }}'

      - name: email_status
        description: '{{ doc("cio_status") }}'

      - name: num_signups
        description: '{{ doc("num_signups") }}'

      - name: most_recent_signup
        description: '{{ doc("most_recent_signup") }}'

      - name: num_rbs
        description: '{{ doc("num_rbs") }}'

      - name: total_quantity
        description: '{{ doc("total_quantity") }}'

      - name: most_recent_rb
        description: '{{ doc("most_recent_rb") }}'

      - name: first_rb
        description: '{{ doc("first_rb") }}'

      - name: avg_time_betw_rbs
        description: '{{ doc("avg_time_betw_rbs") }}'

      - name: avg_days_next_action_after_rb
        description: '{{ doc("avg_days_next_action_after_rb") }}'

      - name: days_to_next_action_after_last_rb
        description: '{{ doc("days_to_next_action_after_last_rb") }}'

      - name: most_recent_mam_action
        description: '{{ doc("most_recent_mam_action") }}'

      - name: most_recent_email_open
        description: '{{ doc("most_recent_email_open") }}'

      - name: most_recent_all_actions
        description: '{{ doc("most_recent_all_actions") }}'

      - name: last_action_is_rb
        description: '{{ doc("last_action_is_rb") }}'

      - name: days_since_last_action
        description: '{{ doc("days_since_last_action") }}'

      - name: time_to_first_rb
        description: '{{ doc("time_to_first_rb") }}'

      - name: sms_unsubscribed_at
        description: '{{ doc("user_unsubscribed_at") }}'

      - name: user_unsubscribed_at
        description: '{{ doc("user_unsubscribed_at") }}'

      - name: voter_reg_acquisition
        description: '{{ doc("voter_reg_acquisition") }}'
  - name: member_event_log_fnmt
    description: Table containing data for all member events.

    columns:
      - name: event_id
        description: '{{ doc("event_id") }}'

      - name: northstar_id
        description: '{{ doc("northstar_id") }}'

      - name: timestamp
        description: '{{ doc("created_at") }}'

      - name: action_type
        description: '{{ doc("action_type") }}'

      - name: action_id
        description: '{{ doc("action_id") }}'

      - name: source
        description: '{{ doc("source") }}'

      - name: action_serial_id
        description: '{{ doc("action_serial_id") }}'

      - name: channel
        description: '{{ doc("channel") }}'

      - name: type
        description: Whether the user is new or returning

      - name: first_action_month
        description: '{{ doc("first_action_month") }}'
