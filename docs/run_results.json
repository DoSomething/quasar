{"results": [{"node": {"name": "email_subscription_topics_raw", "root_path": "/Users/mrich/projects/quasar/quasar/dbt", "resource_type": "model", "path": "news_subscription/email_subscription_topics_raw.sql", "original_file_path": "models/news_subscription/email_subscription_topics_raw.sql", "package_name": "ds_dbt", "raw_sql": "SELECT DISTINCT\n\t_id as northstar_id,\n\t(audit #>> '{email_subscription_topics,updated_at,date}')::timestamp AS newsletter_updated_at,\n\tjson_array_elements(u.email_subscription_topics)::TEXT AS newsletter_topic\nFROM {{ env_var(\"NORTHSTAR_FT_SCHEMA\") }}.northstar_users_snapshot u\nWHERE audit #>> '{email_subscription_topics,updated_at,date}' IS NOT NULL", "refs": [], "sources": [], "depends_on": {"nodes": [], "macros": []}, "unique_id": "model.ds_dbt.email_subscription_topics_raw", "empty": false, "fqn": ["ds_dbt", "news_subscription", "email_subscription_topics_raw"], "tags": [], "config": {"enabled": true, "materialized": "table", "pre-hook": [], "post-hook": [{"sql": "GRANT SELECT ON {{ this }} TO dsanalyst", "transaction": true, "index": 0}, {"sql": "GRANT SELECT ON {{ this }} TO looker", "transaction": true, "index": 1}], "tags": [], "vars": {}, "persist_docs": {}, "column_types": {}, "quoting": {}, "alias": "email_subscription_topics_raw"}, "schema": "ds_dbt", "database": "quasar_prod_warehouse", "alias": "email_subscription_topics_raw", "columns": {}, "description": "", "compiled": true, "compiled_sql": "SELECT DISTINCT\n\t_id as northstar_id,\n\t(audit #>> '{email_subscription_topics,updated_at,date}')::timestamp AS newsletter_updated_at,\n\tjson_array_elements(u.email_subscription_topics)::TEXT AS newsletter_topic\nFROM northstar_ft_userapi.northstar_users_snapshot u\nWHERE audit #>> '{email_subscription_topics,updated_at,date}' IS NOT NULL", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT DISTINCT\n\t_id as northstar_id,\n\t(audit #>> '{email_subscription_topics,updated_at,date}')::timestamp AS newsletter_updated_at,\n\tjson_array_elements(u.email_subscription_topics)::TEXT AS newsletter_topic\nFROM northstar_ft_userapi.northstar_users_snapshot u\nWHERE audit #>> '{email_subscription_topics,updated_at,date}' IS NOT NULL", "wrapped_sql": "None", "build_path": "../../docs/compiled/ds_dbt/news_subscription/email_subscription_topics_raw.sql"}, "error": null, "skip": false, "status": "SELECT 1254575", "fail": null, "warn": null, "execution_time": 30.730308771133423, "thread_id": "Thread-1", "timing": [{"name": "compile", "started_at": "2019-10-11T22:28:10.229028Z", "completed_at": "2019-10-11T22:28:10.238695Z"}, {"name": "execute", "started_at": "2019-10-11T22:28:10.238852Z", "completed_at": "2019-10-11T22:28:40.479598Z"}]}, {"node": {"name": "user_newsletter_subscriptions", "root_path": "/Users/mrich/projects/quasar/quasar/dbt", "resource_type": "model", "path": "news_subscription/user_newsletter_subscriptions.sql", "original_file_path": "models/news_subscription/user_newsletter_subscriptions.sql", "package_name": "ds_dbt", "raw_sql": "SELECT DISTINCT\n\tf.northstar_id,\n\tf.newsletter_topic,\n\tf.topic_subscribed_at::timestamp,\n\tCASE WHEN newsletters_unsubscribed_at IS NOT NULL\n\t    THEN newsletters_unsubscribed_at\n\t    WHEN topic_unsubscribed_at IS NOT NULL\n\t\tTHEN topic_unsubscribed_at\n\t\tWHEN f.topic_updated_at = f.user_updated_at\n\t\tTHEN NULL\n\t\tELSE f.user_updated_at END AS topic_unsubscribed_at\nFROM (\n\tSELECT DISTINCT\n\t\ts.northstar_id AS northstar_id,\n\t\ts.newsletter_topic,\n\t\tfirst_value(s.newsletter_updated_at) OVER (PARTITION BY s.northstar_id, s.newsletter_topic ORDER BY s.newsletter_updated_at\n\t\t\t) AS topic_subscribed_at,\n\t\tlast_value(s.newsletter_updated_at) OVER (PARTITION BY s.northstar_id, s.newsletter_topic ORDER BY s.newsletter_updated_at\n\t\t\tROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS topic_updated_at,\t\n\t\tlast_value(s.newsletter_updated_at) OVER (PARTITION BY s.northstar_id ORDER BY s.newsletter_updated_at\n\t\t\tROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS user_updated_at,\n\t\tu.topic_unsubscribed_at,\n\t\tua.newsletters_unsubscribed_at\n\tFROM {{ ref('email_subscription_topics_raw') }} s\n\tLEFT JOIN (\n\t\tSELECT\n\t\t\t_id AS id,\n\t\t\tto_timestamp(audit #>> '{email_subscription_topics,updated_at,date}', 'YYYY-MM-DD HH24:MI:SS') AS topic_unsubscribed_at,\n\t\t\tNULL AS newsletter_topic\n\t\tFROM {{ env_var(\"NORTHSTAR_FT_SCHEMA\") }}.northstar_users_snapshot\n\t\tWHERE email_subscription_topics IS NULL AND audit #>> '{email_subscription_topics,updated_at,date}' IS NOT NULL\n\t) u ON u.id = s.northstar_id\n    LEFT JOIN (\n\t\tSELECT\n\t\t\tnorthstar_id,\n\t\t\temail_unsubscribed_at AS newsletters_unsubscribed_at,\n\t\t\tNULL AS newsletter_topic\n\t\tFROM public.user_activity\n\t) ua ON ua.northstar_id = s.northstar_id\n) f", "refs": [["email_subscription_topics_raw"]], "sources": [], "depends_on": {"nodes": ["model.ds_dbt.email_subscription_topics_raw"], "macros": []}, "unique_id": "model.ds_dbt.user_newsletter_subscriptions", "empty": false, "fqn": ["ds_dbt", "news_subscription", "user_newsletter_subscriptions"], "tags": [], "config": {"enabled": true, "materialized": "table", "pre-hook": [], "post-hook": [{"sql": "CREATE INDEX IF NOT EXISTS email_subscription_topics_i ON {{ this }}(topic_subscribed_at, northstar_id)", "transaction": true, "index": 0}, {"sql": "GRANT SELECT ON {{ this }} TO dsanalyst", "transaction": true, "index": 1}, {"sql": "GRANT SELECT ON {{ this }} TO looker", "transaction": true, "index": 2}], "tags": [], "vars": {}, "persist_docs": {}, "column_types": {}, "quoting": {}, "alias": "user_newsletter_subscriptions"}, "schema": "ds_dbt", "database": "quasar_prod_warehouse", "alias": "user_newsletter_subscriptions", "columns": {}, "description": "", "compiled": true, "compiled_sql": "SELECT DISTINCT\n\tf.northstar_id,\n\tf.newsletter_topic,\n\tf.topic_subscribed_at::timestamp,\n\tCASE WHEN newsletters_unsubscribed_at IS NOT NULL\n\t    THEN newsletters_unsubscribed_at\n\t    WHEN topic_unsubscribed_at IS NOT NULL\n\t\tTHEN topic_unsubscribed_at\n\t\tWHEN f.topic_updated_at = f.user_updated_at\n\t\tTHEN NULL\n\t\tELSE f.user_updated_at END AS topic_unsubscribed_at\nFROM (\n\tSELECT DISTINCT\n\t\ts.northstar_id AS northstar_id,\n\t\ts.newsletter_topic,\n\t\tfirst_value(s.newsletter_updated_at) OVER (PARTITION BY s.northstar_id, s.newsletter_topic ORDER BY s.newsletter_updated_at\n\t\t\t) AS topic_subscribed_at,\n\t\tlast_value(s.newsletter_updated_at) OVER (PARTITION BY s.northstar_id, s.newsletter_topic ORDER BY s.newsletter_updated_at\n\t\t\tROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS topic_updated_at,\t\n\t\tlast_value(s.newsletter_updated_at) OVER (PARTITION BY s.northstar_id ORDER BY s.newsletter_updated_at\n\t\t\tROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS user_updated_at,\n\t\tu.topic_unsubscribed_at,\n\t\tua.newsletters_unsubscribed_at\n\tFROM \"quasar_prod_warehouse\".\"ds_dbt\".\"email_subscription_topics_raw\" s\n\tLEFT JOIN (\n\t\tSELECT\n\t\t\t_id AS id,\n\t\t\tto_timestamp(audit #>> '{email_subscription_topics,updated_at,date}', 'YYYY-MM-DD HH24:MI:SS') AS topic_unsubscribed_at,\n\t\t\tNULL AS newsletter_topic\n\t\tFROM northstar_ft_userapi.northstar_users_snapshot\n\t\tWHERE email_subscription_topics IS NULL AND audit #>> '{email_subscription_topics,updated_at,date}' IS NOT NULL\n\t) u ON u.id = s.northstar_id\n    LEFT JOIN (\n\t\tSELECT\n\t\t\tnorthstar_id,\n\t\t\temail_unsubscribed_at AS newsletters_unsubscribed_at,\n\t\t\tNULL AS newsletter_topic\n\t\tFROM public.user_activity\n\t) ua ON ua.northstar_id = s.northstar_id\n) f", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT DISTINCT\n\tf.northstar_id,\n\tf.newsletter_topic,\n\tf.topic_subscribed_at::timestamp,\n\tCASE WHEN newsletters_unsubscribed_at IS NOT NULL\n\t    THEN newsletters_unsubscribed_at\n\t    WHEN topic_unsubscribed_at IS NOT NULL\n\t\tTHEN topic_unsubscribed_at\n\t\tWHEN f.topic_updated_at = f.user_updated_at\n\t\tTHEN NULL\n\t\tELSE f.user_updated_at END AS topic_unsubscribed_at\nFROM (\n\tSELECT DISTINCT\n\t\ts.northstar_id AS northstar_id,\n\t\ts.newsletter_topic,\n\t\tfirst_value(s.newsletter_updated_at) OVER (PARTITION BY s.northstar_id, s.newsletter_topic ORDER BY s.newsletter_updated_at\n\t\t\t) AS topic_subscribed_at,\n\t\tlast_value(s.newsletter_updated_at) OVER (PARTITION BY s.northstar_id, s.newsletter_topic ORDER BY s.newsletter_updated_at\n\t\t\tROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS topic_updated_at,\t\n\t\tlast_value(s.newsletter_updated_at) OVER (PARTITION BY s.northstar_id ORDER BY s.newsletter_updated_at\n\t\t\tROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS user_updated_at,\n\t\tu.topic_unsubscribed_at,\n\t\tua.newsletters_unsubscribed_at\n\tFROM \"quasar_prod_warehouse\".\"ds_dbt\".\"email_subscription_topics_raw\" s\n\tLEFT JOIN (\n\t\tSELECT\n\t\t\t_id AS id,\n\t\t\tto_timestamp(audit #>> '{email_subscription_topics,updated_at,date}', 'YYYY-MM-DD HH24:MI:SS') AS topic_unsubscribed_at,\n\t\t\tNULL AS newsletter_topic\n\t\tFROM northstar_ft_userapi.northstar_users_snapshot\n\t\tWHERE email_subscription_topics IS NULL AND audit #>> '{email_subscription_topics,updated_at,date}' IS NOT NULL\n\t) u ON u.id = s.northstar_id\n    LEFT JOIN (\n\t\tSELECT\n\t\t\tnorthstar_id,\n\t\t\temail_unsubscribed_at AS newsletters_unsubscribed_at,\n\t\t\tNULL AS newsletter_topic\n\t\tFROM public.user_activity\n\t) ua ON ua.northstar_id = s.northstar_id\n) f", "wrapped_sql": "None", "build_path": "../../docs/compiled/ds_dbt/news_subscription/user_newsletter_subscriptions.sql"}, "error": "Database Error in model user_newsletter_subscriptions (models/news_subscription/user_newsletter_subscriptions.sql)\n  server closed the connection unexpectedly\n  \tThis probably means the server terminated abnormally\n  \tbefore or while processing the request.\n  compiled SQL at ../../docs/compiled/ds_dbt/news_subscription/user_newsletter_subscriptions.sql", "skip": false, "status": "ERROR", "fail": null, "warn": null, "execution_time": 9725.629031896591, "thread_id": "Thread-1", "timing": []}], "generated_at": "2019-10-12T01:10:47.126682Z", "elapsed_time": 9758.653131008148}